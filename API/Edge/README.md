# RealEstateCore Edge Message

With a specified schema for compact legible JSON messages, RealEstateCore Edge Messages are powerful yet portable across implementations of RealEstateCore. Edge messages can contain one or more Observations, Actuation-related messages and meta-telemetry like Exceptions. Edge messages are both edge-to-cloud (from a core:Device) and cloud-to-edge (to a core:Device).

The Edge Message specification is expressed using JSON Schema (see [json-schema.org](https://json-schema.org/)) and the edge_message.schema.json file below. For a quick look, see the example message.  
(since it combines both edge-to-cloud and cloud-to-edge components in one and the same message, it should probably be considered an illustration rather than example).

## Edge Message Walkthrough

The format corresponds to a version of RealEstateCore and is stated at the root of the message, so that different versions devices using different versions can be used next to each other, but still parsed correctly.  
`"format": "rec3.3"`

Edge messages are sent to or from core:Devices. Hence Device Id is also included in the message root.  
`"deviceId":"myDeviceId"`

Since Edge devices might have limited bandwidth, multiple message components (e.g. two Observations) can be included in the same Edge message.

Edge device may also sporadically be offline and edge messages sent asynchronously, which is why each message components have their own timestamp.

Each message can contain an array of Observations, an array of Exceptions, and an array of ActuationResponses. (or just one of them, or some other combination etc.)

### Observations
(edge-to-cloud)  
Observations `"observations" (device:Observation)` are generated by a core:Sensor. It holds a time and a value, which can be one of:
- "value"  
- "valueString"  
- "valueBoolean"

(It can be either one of the three types of value, not a combination of them in the same observation.)

### Actuation Commands
(cloud-to-edge)  
Actuation Commands `"actuationCommands" actuation:actuationCommand` are sent to a core:Actuator, it can have the same value types as an observation. In addition to the Actuator ID, it also includes a unique ID of the Actuation Command.

### Actuation Command Responses
(edge-to-cloud)  
Actuation Command Responses `"actuationCommandResponses" actuation:actuationCommandResponse` is sent back from the Actuator. It acknowledges that a specific Actuation Command has been received, with a `"responseCode"` signifying:
- "success" (comparable to HTTP status 200):  
  the Actuation Command has been successfully received and the actuation in the underlying edge system has been attempted.
- "rejected" (comparable to HTTP status 462):  
  the Actuation Command was rejected by the Actuator before the actuation was attempted in the underlying system, or rejected by the underlying system. More details could possibly be expressed via an "Exception" message, see below (the Exception could be included in the same edge message, or sent in a separate message). The reason for a rejected Actuation Command could be that the format is incorrect, or that the edge system is offline.
- "none" (comparable to HTTP status 460):  
  The actuation has failed to be received or forwarded to the underlying system by some other possibly unknown reason. As with "rejected", more details could be sent in an Exception.

### Exceptions
(edge-to-cloud)  
Exceptions `device:Exception` are sent from a core:Device, core:Sensor or core:Actuator. It includes ID `"id"` and the type of device or subclass of device that generated the exception `"origin"`. To describe the exception  there is a string `"exception"` and a `"retry"` property that is `1` by default, and can increment if applicable.